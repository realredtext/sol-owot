w._state = state;
pasteSpeedMult=10,clearInterval(char_input_check),char_input_check=setInterval(function(){if(!w._state.uiModal&&!write_busy){var e=elm.textInput.value,t=getDate()-previousErase<1e3;if(e)if(""!=e){if(stabilizeTextInput(),1==(e=w.split(e.replace(/\r\n/g,"\n").replace(/\x7F/g,""))).length)return writeChar(e[0]),void(elm.textInput.value="");clearInterval(pasteInterval);Permissions.can_paste(state.userModel,state.worldModel);var r,l,a=!0;cursorCoords?(r=textcode_parser(e,{tileX:cursorCoords[0],tileY:cursorCoords[1],charX:cursorCoords[2],charY:cursorCoords[3]},YourWorld.Color),write_busy=!0,pasteInterval=setInterval(function(){for(var e=0;e<pasteSpeedMult;e++)if(-1==function(){if(a?l=r.nextItem():a=!0,-1==l)return-1;var e,t;if("char"==l.type){if(l.writable){if(""==l.char)return!0;if(null===writeChar(l.char,!1,l.color,!l.newline))return a=!1;0}}else"link"==l.type?"url"==l.linkType&&Permissions.can_urllink(state.userModel,state.worldModel)?linkQueue.push(["url",l.tileX,l.tileY,l.charX,l.charY,l.url]):"coord"==l.linkType&&Permissions.can_coordlink(state.userModel,state.worldModel)&&linkQueue.push(["coord",l.tileX,l.tileY,l.charX,l.charY,l.coord_tileX,l.coord_tileY]):"protect"==l.type&&(t=!0,(e=l.protType)<=1&&(Permissions.can_protect_tiles(state.userModel,state.worldModel)||(t=!1)),2==e&&(Permissions.can_admin(state.userModel,state.worldModel)||(e=1)),t&&network.protect({tileY:l.tileY,tileX:l.tileX,charY:l.charY,charX:l.charX},["public","member-only","owner-only"][e]));return!0}()){clearInterval(pasteInterval),write_busy=!1,elm.textInput.value="";break}},Math.floor(1e3/280))):elm.textInput.value=""}else t||(elm.textInput.value="");else t&&(elm.textInput.value="")}},10);
